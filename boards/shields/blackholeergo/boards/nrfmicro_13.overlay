#include <dt-bindings/led/led.h>

    / {
        chosen {
            zmk,display = &oled_display; // Choose oled as display
        };
    };

    &pinctrl {
      // Add pin control for the SPI devices.
      oled_spi_default: oled_spi_default {
        group1 {
          psels = <NRF_PSEL(SPIM_SCK, 0, 20)>,
                  <NRF_PSEL(SPIM_MOSI, 0, 17)>;
        };
      };

        led_spi_default: led_spi_default {
            group1 {
                psels = <NRF_PSEL(SPIM_MOSI, 0, 06)>;
            };
        };

        oled_spi_sleep: oled_spi_sleep {
            group1 {
                psels = <NRF_PSEL(SPIM_SCK, 0, 20)>,
                        <NRF_PSEL(SPIM_MOSI, 0, 17)>;
                low-power-enable;
            };
        };

        led_spi_sleep: led_spi_sleep {
            group1 {
                psels = <NRF_PSEL(SPIM_MOSI, 0, 06)>;
                low-power-enable;
            };
        };
    };

    &spi1 {
        compatible = "nordic,nrf-spim"; // Use SPIM (SPI Master)
        status = "okay";
        pinctrl-0 = <&oled_spi_default>;
        pinctrl-1 = <&oled_spi_sleep>;
        pinctrl-names = "default", "sleep";

        oled_display: oled_display {
            compatible = "solomon,ssd1306fb";
            reg = <0>; // Chip select, usually 0 for SPI
            label = "DISPLAY";
            width = <128>;   // Set your OLED width
            height = <32>;  // Set your OLED height
            segment-offset = <0>;
            page-offset = <0>;
            display-offset = <0>;
            multiplex-ratio = <31>;
            segment-remap;
            com-invdir;
            com-sequential;
            prechargep = <0x22>;
        };
    };

    &spi2 {
        compatible = "nordic,nrf-spim";
        status = "okay";
        pinctrl-0 = <&led_spi_default>;
        pinctrl-1 = <&led_spi_sleep>;
        pinctrl-names = "default", "sleep";
       // spi-max-frequency = <4000000>; // Set the maximum SPI frequency, important for WS2812

        led_strip: ws2812@0 {
            compatible = "worldsemi,ws2812";
            label = "LED_STRIP";
            reg = <0>; // Chip select (not used for single device on bus)

            // Chain length: adjust this to the number of LEDs in your strip
            chain-length = <10>;  //  CHANGE THIS to your actual LED count!

            // SPI bus configuration
            spi-max-frequency = <4000000>; // WS2812 requires a specific timing, 4MHz often works well

            // Color mapping (GRB is typical for WS2812)
            color-mapping = <LED_COLOR_ID_GREEN
                             LED_COLOR_ID_RED
                             LED_COLOR_ID_BLUE>;
        };
    };

